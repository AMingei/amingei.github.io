<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://example.com/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 5.4.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header-copy">
  <button class="header-icon" id="menu-icon"></button>
  <button class="header-icon" id="srch-icon"></button>
</header>
      <div id="graymask"></div>
      <div id="lefter">
  <div id="left-bar">
    <div id="left-panel">
      <div id="panel-datetime"></div>
      <div id="panel-nickname">
        AMing's Blog
      </div>
      
        <a class="panel-nav" href="
        
          /
        
        ">
          <div>
            主页 HomePage
          </div>
        </a>
      
        <a class="panel-nav" href="
        
          /archives
        
        ">
          <div>
            归档 Archives
          </div>
        </a>
      
        <a class="panel-nav" href="
        
          #
        
        ">
          <div>
            nothing-1
          </div>
        </a>
      
        <a class="panel-nav" href="
        
          #
        
        ">
          <div>
            nothing-2
          </div>
        </a>
      
    </div>
  </div>
  <div id="ethan">
    <img alt="Ethan">
  </div>
</div>

<svg id="svg" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
	 viewBox="0 0 595.28 841.89"  xml:space="preserve">
<clipPath id="svgtest" fill="none" stroke="black">
	<path d="M287.6,336.5c2.3,4,0.8,6.1,1.5,5.8c0.4,1,0.4,2.2,0.1,2.9c-1.3,2-3.6,1.3-3.6,1.3s-0.1,0.7-0.1,2.1
		c-1.1,0.2-5.4,0.3-7.2,0.8c-2.1,0.6-3.7,1.4-5.5,1.6c-0.9,0.1-1-1-1.7-0.9c-2.6,0.3-3,0.4-4.6,0.6c-4.4,0.5-3.8-0.3-3.5-4.6
		c0.1-2,0.2-6.9,0.2-8c-2.1-0.8-4,1.8-10.5,1.3c-3.3-2.1-5.9-3.2-7.9-7.1c-2-0.3-2.6,0.2-5.9-0.4c1.1,5.6,1.9,10.2,2.9,14.8
		c0.5,2.2,1.3,4.3,1.6,6.5c0.6,3.9,1.8,6.9,6.5,7.2c2.4,0.1,2.3,2.1,1.8,4c-1.2,4.5-2.7,10.2-4.1,14.6c-1.1,3.7-1.9,4.2,0,7.9
		c2.3,4.4,5.2,11.4,7.1,16.1c9.1-7.2,9.3-6,10.9,3.5c0.4,2.4,2.4,6.9,3.7,8.9c0.6,0.9,1.8,1.1,3.7-0.3c5.1-1.7,8.2-1.7,11.6,7.3
		c3,7.9,1.4,9.6,8.9,8c2.3,0.2,2.9,0.2,3.9,3.2c1,3,2.8,5.4,4.4,8.6c1.1,0.1,2,0.3,2.2,2.1c2.5,0.5,5,1.7,6.5,2.2
		c7.4,3.7,22.1,8.4,22.1,8.4s14.9,3.7,31.8-1.5c4-1.8,19.8-7.6,25.1-21.9c4.3-11.1,4.5-15.3,5.1-23.4c1.3-15-7.9-29.5-22.9-34.5
		c-13.3-4.4-26.5-2.6-37.7,6.7c-4.1,3.4-6.5,8.1-7.6,14.2c4.9-5.1,10.2-7.9,16.8-8c12-0.1,25.4,13.4,20,28
		c-3.7,10-9.1,18.9-20.6,19.8c-14.5,1.2-27.3-5.6-33.4-20.2c-5.5-13.1-4.1-25.8,1.9-38.3l0.3-0.8c0.9-1.8,1.9-3.5,2.8-5.3
		c5.5-10.3,14.2-17.2,24.3-22.6c8.6-3.8,8.6-3.8,20.8-5.4c30.6,1.5,39.4,9,45.3,13.2s21.8,15.8,27.2,25.6s10.3,21.6,10.3,24.1
		c3.8,15.5,3.8,25,1.2,35.7c-4.7,19.2-12.4,37.2-24.6,53c-11.7,15.2-25.4,28.2-44.9,32.4c-10.7,2.3-15.3,3.4-26.1,5.1
		c-13.6,2.1-33.5,0.5-47.1-1.3c-3.5,13.8-11.9,24.7-20.4,35.5c-6.1,7.8-19.3,23.9-19.3,23.9s-0.1,1.1,1.2,0.9c2.9-0.4,8.2,0,9.1,0.3
		c2.6,1,2.3,1.6,2.5,5.2c-1.8,10.1-3.5,20.1-5.5,30.1c-0.5,2.2-2.6,4.1-3.6,6.3c-0.5,1.2-1.9,1.2-1.7,2.6c0.3,2.2,2.9,3.8,3.4,4.8
		c-2.3,8.1-0.4,12.9,0.2,16.4c3.1,1.2,5.9,15.2,5.9,15.2s0.1,3.4,0.6,3.4c3.5-0.1,4.7,1.1,5.7,3.3c1.8,3.7,3.7,8.4,5.4,12.2
		c0.6,1.4,1,3.3,0.5,4.6c-3.4,8.8-10.1,15-17.5,20.4c-1.8,1.3-3.5,0.8-5-0.8c-4.8-4.6-4.7-4.4-9.3-0.2c-1.2,1.1-3.6,0.9-5.3,0.5
		c-7.5-1.8-13.9-5.7-19.2-11.1c-4-4-10.4-12.3-10.3-13.6s6.2-7.2,6.2-7.2s-0.1-4.1,2.4-9.1c1.8-3.7,5-9.4,6-13.3
		c0.5-2.1-1.7-3.7-2.7-5.8c-0.9-1.9-1.9-1.5,0-6.8c0.7-2-0.2-3.4-1.4-5.1c-7.7-11.1-12.4-24.4-16.4-37.3c-0.8-2.5-0.5-4.2,2.4-5.2
		c5.2-1.8,10.5-4.3,16.3-6.5c-6-4.2-10.7-9.2-17.4-11.5c-1.9-0.6-6.6-2.4-8.2-3.6c-3.5-2.5-2.3-10.7-2.3-10.7l-1.5-1.2
		c0,0-0.4-4.1-1.3-5.1c-0.9-1-1.8-1.4-2.6-1.6c-1.8-0.3-4.1,4.5-4.1,4.5s-3.3,8.1-4.8,12.1c-1.5,4-2.2,4.6-6,2.8
		c-2.8-1.3-5.5-3-7.8-5c-2.3-2,2.6-7.9,3.9-9.9c1.9-3,2.5-5.9,2.5-5.9l-6.9-3.1l-8.2-5.9c0,0-4.8,4.6-7.1,6.5
		c-4.6,3.9-4.4,4.3-19.8,3.8c-0.7,0-1.9,0.8-1.4,2.3c-0.6-1.9-0.8,4.3-0.1,6.4c0.2,0.8,1.6,0.5,2.4,1.2c0.4,0.3-0.2,4,0.8,4
		c1.5-0.1,3.8-4.8,3.8-4.8l9.7,0.6l-0.4,5.3c0,0-4.3,4.2-5.1,4.8c-2.2,1.5-4.8,4-4.8,4s0.6,3.8,1.7,6.1c1.3,2.5-0.8,4.1-2.3,5.8
		c-1.5,1.8-4.4,4-4.4,4l-0.1,10.2c0,0,4.1,1.7,5.7,2.5c4.7,2.4,6.6,6.3,4.6,9.9c-1.2,2.2-2.7,3.2-5.1,1.3c-1.5-1.3-3-2.8-4.9-4.2
		c-1.6,3.5-0.3,7.1,0.2,10.4c0.1,0.7,0.7,1.3,0.8,2.1c1.5,6.9,5.2,12.4,9.9,17.6c4.8,5.3,4,8.4-1.8,12.7
		c-6.5,4.8-13.6,8.3-21.5,10.2c-1.3,0.3-3.1,0.8-3.9,0.1c-5.1-3.6-9.2,0.2-13.7,1.5c-0.4,0.1-1.1,0.6-1.1,0.9c0,5.7-5.4,6.6-8.6,9.3
		c-10.1,8.3-21.3,7.5-32.8,3.3c-2.4-0.9-5-1.9-2.9-5.7c-2.8-0.5-5.7-0.7-8.1-1c-2.1-0.2-1.9-1.5-1.5-3.5c2.4-6.4,6.1-11.7,9.8-17.1
		c0.9-1.3,3.7-1.7,5.9-0.9c1.9,0.7,2.8,1.2,3.8,1c0.8-0.1,2.1-1.5,2.7-1.9c10.2-6.8,17.4-16.3,23-27.1c0.4-0.8,1.3-0.7,1-1.5
		c-0.7-1.7-1.7-4.7-1.7-4.7s0.9-5.7,2.8-8.6c0.8-1.3-1.1-2-2-3.4c-6.7-10.2-11.1-15.1-16.5-26.5c-1.2-2.5,0.3-3,2.4-4.4
		c3.8-2.5,8.9-5.7,15.3-7.8c-0.8,0.3-0.3-0.8-4.1-2.4c-5.3-2.3-11.3-5.2-16.1-8.6c-7.9-5.6-14.6-10.6-21.4-17.3
		c-7.1-7-14.3-16.3-20.3-24.3c-0.8-1.1-0.2-3.4,0.3-4.5c2.7-5.8,6.4-13.1,10.4-14.6c1.3-0.5,1.2-3.5,1.5-4.8c1.2-6,3-19.8,3-19.8
		s-3.9-1-6.5-1.1c0,0-0.2-2,0.6-7.1l5.7-30.2l8.4-45.7l3.5-18.4l0.4-21.1l3.4-1.8l5.4-22l0.9-0.6l7.2-32.8c-2.9-1.7-5.7-3.4-7.9-4.6
		c-0.5,2.2-2.7,3.7-4,3.8c-4,0.2-4.9-1-6.6,3.5c-3.7,4.6-6,7.6-9.8,8.6c-14.9,1.8-19-12.2-17.9-12.8c1.1-0.6,0.9,0.2,0-3.4
		c-0.4-1.6,0.3-3.4,1.4-3.9c2.4-1.1,10.2,1.4,10.8,2.2c2.1-0.1,2.4-0.4,2.7-0.5c1.9-1.2-0.4-4.9-0.3-7.9c0.1-1.7,3.1-2.4,4.2-3.3
		c-3.1-3.1-9.2-5.6-13.4-6.3c-2.8-0.5-3-2.6-2.6-5.3c0.6-3.8,0.5-2.9-1.3-3.8c-0.7-0.4-2.5-2.9-3.7-3.6c-1.3-0.8-3-0.7-3.9-1.1
		c-0.7-0.4-4.3-2.1-6.9-5.7c-4.7-7.5-8.5-11.6-12.9-23.2c-0.6-1.6-0.5-6.4-0.4-8.4c0,0-0.1-4.2-0.1-6.2c-0.2-2.3-0.7-6-1.1-8
		c-4.3-3.6-4.1-3-5.1-8.2c-1.5-1.4-1.8-1.4-2.9-2.3c-1.3-4.9-1.7-7.4-0.6-11.7c3.1-5.8,2.4-15,2.5-15.5s0.3-1.9,1.3-4.2
		c3.3-1.7,5.2-8.9,11.6-16.8c7.7-8.7,10.3-6.8,16.4-7.2c3.5,1.5,2.7,1.3,4.8,2c1.1,0.4,2.4,0.6,3.6,0.4c2.2-0.3,4.5-1.5,6.6-1.2
		c4,0.5,8.2,1.4,11.9,3.1c2.2,1,3.6,3.9,5.5,5.8c1.2,1.2,2.4,2.3,3.9,3.1c2.6,1.5,3.8,3.1,2.1,6.1c-0.4,0.7,0,2.1,0.4,3
		c3.5,7.9,5.4,15.8,2.5,24.3c-3.4,9.6-8.5,15.2-18.1,18.4c-0.7,0.2-3.1,1-3.8,1.2c-0.4,0.1-0.6,0.4-1.3,0.7c1,1.7,1.1,2.3,1.9,4.1
		c0.6,1.3,1,4.4,1.6,5.6c0.6,0.9,1.7,0.6,1.8,1.7c0.3,2.1-0.4,5,1.9,6.6c-0.5,1.3-1,2.3,3.9,6.8c1.4-1.3,2.3-2.8,3.5-3.9
		c0.6,0.2,1.1,0,1.7,1.1c1.2,2.1,2.4,6.8,3.2,5.7l4.5-3.4l1.3,0.3c0,0,4.9,3.7,7.4,6.9c0.6-0.1,1.7-0.3,1.7-0.3s-2.9-5.1-2.8-5.7
		c0-0.6,1.5-1.6,3.7-2.2c2.1-0.3,4.7-0.2,4.7-0.2s0.1-2.7,0.6-5.2c7.4-17.3,15.8-28,15.8-28l1.3-4c0,0,1-0.6,1.4-2.9
		s0.6-2.9,1.2-3.6s0.4-0.6,1.4-0.9c0.2-7.2,2.5-14.8,2.5-14.8l10.2-10.1c0,0,0.4-1.8-0.9-1.9c-1.2-0.1-2.9-2.4-2.9-2.4
		s-9.3-22.6-9.2-25.8c4.4-5.2,28-11.8,40.2-12.7c-5.4-0.3-16.6-0.2-20.6-0.2c0-0.3-0.1-1.9,0-2.2l0-3.9c-2-5.2-1.7-6-4.3-11.1
		c-1.2-4.2-1.8-5.5-1.7-8.4c-2.5-0.9-16.7-6.3-16.7-6.3s0.1-2.1,1.7-3.4c3.5,1.5,8.1,3.6,12.1,5.3c-4-5.7-4.7-9.8-5.5-13.5
		c4-4,8.9-2.9,10.6-3.2c0.4-2.5,1.2-10.4,0.8-14.8c-1.6-0.9-2.6-2.6-3.3-4.5c-0.7-0.6-2.9-0.1-4.3-0.5c-1-0.3-2.4-0.8-2.3-2.4
		c0.1-1.6,1.6-1.7,4.6-1.7c-1.1-5.1-1-12.2,3.4-18.6c1.2-1.7-1.8-4.5-4.1-8.3c-0.1-2.1-0.1-3.8,0.1-4.3c0.2-0.5,2.2-2.5,3.2-2.9
		c1-0.4,25.4-4.7,27.7-4.2l4.4-0.2c0,0,6.8-4.9,8.4-5.6c1.6-0.7,2.7-0.2,2.7-0.2l0.4,5.1c0,0,1.9,0.1,3.5,0.1c7.3-7.4,39-7.9,39-7.9
		l5.8,0.7c0,0-2.9,1.5-2.4,1.8c4.8,2.1,6.5,3.8,7.1,4.2C223,7.5,211,9.7,211,10.8c14.3,2.9,29.1,9.9,29.3,11.2
		c-1.9,1.6-2.3,2.4-2.9,3.1c8.6,8,17.3,18.1,17.3,18.1l-18.6-1.5l3.1,9.2c3.2,1.4,5.4,7.5,5.9,9.3c0.6,0,2.9,7.7,4,9.9
		c2.8,0,3,0.8,3.3,1.6c0.8,0.1,1,0.2,3.4-0.6c0.3-0.1,1.6,0.3,2.4,0.1c1.3-0.4,3-1.4,3.5-1.4c0.7,0,1.3,1.1,1.3,1.7
		c0,0.6-2.5,1.4-3,1.7c-1.4,0.8-4.9,2.5-6.2,3.3c-0.1,0.3,0.1,1.3-0.1,1.7c-2.2,1.1-5.7,1.7-8,2c-0.6,0.1-1.1-3.9-1.9-5.2
		c-0.7,2.4-16,24.4-23.5,24.8l-0.2,5.8c-2.1,0.9-5.8,0.5-5.8,0.8c0,0.3-0.1-0.1-0.1,2.1c10.3-2.8,37.8-6.6,40.1-5.8
		c1.5,2.4,5.9,22.8,4.7,37.9c-0.4,5.4-2.2,12.8-2.9,18.2c-0.1,1.2,2,3.8,2.4,5c1.3,3.9,3,6.4,3,8.4c-0.1,2.2,0.2,4.1-3.3,6.4
		c-1.9,1.5-6.7,2-6.7,2s0.2,2.2,0.6,3.1c0.3,0.6,0.3,2.3-0.3,3.2c0,0,0.4,2.1,0.9,6.6c0.5,4.4,0,10.6,0,14.9c0.2,0.3,0,14.7,0,14.7
		c0.7,0.3,0.6,1.5,0.6,2.5c0.1,3.7-0.1,27.3-0.1,28.1c3,0.5,5.5,5.9,5.5,5.9c0.2,4.9-2.1,11.1-2.1,11.1s-0.2,2.4-0.6,6.4
		c-1.9,3-3.6,4.6-0.1,7.8c2,6.8,2.2,16.8,5.6,14c5.6,0.7,7.1,3.7,4.2,8.5c-2.2,3.6-4.4,4.8-3,9.2c1.2,4.3-0.8,8-1,7.5
		c0,0,2.4,3.7,2.9,7.2C267.6,331.1,282.9,328.6,287.6,336.5z M145.4,619.8c0.6-1,0.6-2.7,0.3-3.6c-0.6-1.7-3.1-3.1-7.7-5.5
		C139.8,618.2,144.9,619.3,145.4,619.8z M190,8.7c-6.3-0.1-12.5,0-18.8,0.1c-0.4,0-0.9,0.3-1.3,0.4 M326.8,409.5
		c0.9,3.4,4.9,9.8,11.4,10.1c7.6-0.5,11.8-3.6,10.7-13.1c-0.4-4-3.6-6.4-6.8-7.1c-4,0.2-4.9,1.1-6.1,3.7c-0.7,1.5-1.6,2.8-2.3,4.2
		C332.2,410.4,329.5,412,326.8,409.5z M128.2,17.2c-1.6,1.1-0.9,3.5,1.7,7.4c2.4-2.4,3.7-3.5,4.6-4.9c0.1-1.7,2.8-3.9,5.2-4.8
		C135.1,15.3,129.8,16.1,128.2,17.2z M50.5,294c-3.2-0.1-5.3-2.3-6.1-2.5c-0.6-0.1-2.9-0.2-2.9,0.7c0,4,2.1,2.3,2.3,3
		c0.8,2.5,4.9,4.9,5.4,5.1c1.2,0.1-0.1,2.4,1.6,2.7c4.5,1.2,12.4-7.8,11.1-9.3c-1.1-0.4-4.8-3.1-7.1-3
		C52.9,291.7,51.6,293.2,50.5,294z"/>
</clipPath>
</svg>
 
      <div class="outer">
        <section id="main">
  
    <article id="post-200721-JsMultiKeyListener" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2021/07/21/200721-JsMultiKeyListener/" class="article-date">
  <time datetime="2021-07-21T10:34:50.000Z" itemprop="datePublished">2021-07-21</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/07/21/200721-JsMultiKeyListener/">基于JavaScript的多按键检测</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>基于JavaScript的多按键检测</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">(੭ ᐕ)੭ 阿巴阿巴。。。</span><br><span class="line"></span><br><span class="line">源于某 有生之年 前端小游戏开发途中遇到的坑，</span><br><span class="line">查了些资料发现这是大佬们懒得整的 简单 问题，</span><br><span class="line">对于小菜鸡（菜鸡本菜）来说还是记录一下开发过程的好，</span><br><span class="line">遂 出现了这篇笔记。</span><br></pre></td></tr></table></figure>
<h1 id="关于成品"><a href="#关于成品" class="headerlink" title="关于成品"></a>关于成品</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">setKeyListener()</span><br><span class="line">keyDown(key, callback_1, callback_2)</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>参数</th>
<th>必需</th>
<th>格式</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>key</td>
<td>true</td>
<td>Int or Array</td>
<td>指定按键的keyCode或keyCode数组</td>
</tr>
<tr>
<td>callback_1</td>
<td>true</td>
<td>function(event)</td>
<td>keyDown响应函数</td>
</tr>
<tr>
<td>callback_2</td>
<td>false</td>
<td>function(event)</td>
<td>keyUp响应函数</td>
</tr>
</tbody></table>
<h1 id="关于源码"><a href="#关于源码" class="headerlink" title="关于源码"></a>关于源码</h1><h2 id="提要"><a href="#提要" class="headerlink" title="提要"></a>提要</h2><p>对于原生的<code>addEventListener(&#39;keydown&#39;, listener, options)</code>，只能监听单一按键，实现多按键通常有两个思路：</p>
<ul>
<li>记录每次 keydown/keyup 信息，每次触发 keydown 时判断是否有按键已经按下，执行相应动作</li>
<li>记录每次 keydown/keyup 信息，设置循环，循环触发相应动作</li>
</ul>
<p>ps：以下代码依照前者实现</p>
<h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><h3 id="初始化"><a href="#初始化" class="headerlink" title="初始化"></a>初始化</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Key</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="title">constructor</span>(<span class="params">keyCode</span>)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.keyCode = keyCode;</span><br><span class="line">        <span class="built_in">this</span>.isDown = <span class="literal">false</span>;</span><br><span class="line">        <span class="built_in">this</span>.keyGroup = [];</span><br><span class="line">        <span class="comment">// 存储关联按键组合</span></span><br><span class="line">        <span class="comment">// 格式[&#123;[keyCode1, keyCode2, ...], function()&#123;&#125;&#125;, &#123;&#125;, ...]</span></span><br><span class="line">        <span class="built_in">this</span>.callback_1 = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;;</span><br><span class="line">        <span class="built_in">this</span>.callback_2 = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="title">keyDown</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.callback_1();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="title">keyUp</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.callback_2();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> keys = [],          <span class="comment">// 记录已绑定事件的按键，数组元素为 Key，数组序号同 keyCode</span></span><br><span class="line">    remainKeys = [],    <span class="comment">// 记录 keyup 后剩余的按键</span></span><br><span class="line">    lastKey;            <span class="comment">// 记录 latest keydown</span></span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 设置按键监听器</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">setKeyListener</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">    addEventListener(<span class="string">&#x27;keydown&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">event</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> val = event.keyCode;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 判断该按键是否绑定事件</span></span><br><span class="line">        <span class="keyword">if</span>(keys[val] === <span class="literal">undefined</span>)</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">        keys[val].isDown = <span class="literal">true</span>;</span><br><span class="line">        lastKey = keys[val];</span><br><span class="line">        <span class="keyword">var</span> tempKey = keys[val];</span><br><span class="line">        <span class="comment">// 多按键检测</span></span><br><span class="line">        mutiKeyJudge(tempKey, val);</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    addEventListener(<span class="string">&#x27;keyup&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">event</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> val = event.keyCode;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(keys[val] === <span class="literal">undefined</span>)</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">        keys[val].isDown = <span class="literal">false</span>;</span><br><span class="line">        keys[val].keyUp();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> flag = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 每次有按键松开，更新剩余未松开按键</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">var</span> i <span class="keyword">of</span> keys) &#123;</span><br><span class="line">            <span class="keyword">if</span>(i != <span class="literal">undefined</span> &amp;&amp; i.isDown) &#123;</span><br><span class="line">                flag++;</span><br><span class="line">                remainKeys.push(i);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 所有按键松开后，清空数组</span></span><br><span class="line">        <span class="keyword">if</span>(flag == <span class="number">0</span> || val != lastKey.keyCode) </span><br><span class="line">            remainKeys = [];</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 循环执行循环</span></span><br><span class="line">    <span class="built_in">setInterval</span>(keyDownAuto, <span class="number">30</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="关于循环执行"><a href="#关于循环执行" class="headerlink" title="关于循环执行"></a>关于循环执行</h3><p>对于<code>addEventListener()</code>如果在每次 keydown 时判断要执行的动作，则后触发的事件会覆盖之前的事件。<br>面对同时多按键 keydown 的情况，<br>若 1st/2nd/… key keyup， keydown 监听器依旧被 latest key 触发，根据 remainKeys 的变化匹配触发的动作，正常运行；<br>若 latest key keyup， 由于先前按键的触发事件被 latest key 覆盖， latest key keyup 后， keydown 监听器结束运行，先前按键尽管处于 keydown 状态，但无法被监听。此时借助循环模拟执行按压动作。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">keyDownAuto</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 判断单一/多按键</span></span><br><span class="line">    <span class="keyword">if</span>(remainKeys.length == <span class="number">1</span>) &#123;</span><br><span class="line">        remainKeys[<span class="number">0</span>].keyDown();</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span>(remainKeys.length &gt; <span class="number">1</span>) &#123;</span><br><span class="line">        mutiKeyJudge(remainKeys[<span class="number">0</span>], remainKeys[<span class="number">0</span>].keyCode)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="关于多按键判断"><a href="#关于多按键判断" class="headerlink" title="关于多按键判断"></a>关于多按键判断</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">mutiKeyJudge</span>(<span class="params">tempKey, val</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> tempKeyGroup = <span class="built_in">JSON</span>.parse(<span class="built_in">JSON</span>.stringify(tempKey.keyGroup));</span><br><span class="line">        <span class="comment">// 不严谨</span></span><br><span class="line">            <span class="comment">// console.log(tempKeyGroup)</span></span><br><span class="line">            <span class="comment">// console.log(tempKey.keyGroup[0].callback)</span></span><br><span class="line">    <span class="comment">// Record for Muti-key-pressed status</span></span><br><span class="line">    <span class="keyword">var</span> flag = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> i <span class="keyword">of</span> keys) &#123;</span><br><span class="line">        <span class="keyword">if</span>(i != <span class="literal">undefined</span> &amp;&amp; i.isDown &amp;&amp; i.keyCode != val) &#123;</span><br><span class="line">            flag = <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">var</span> j <span class="keyword">of</span> tempKeyGroup) &#123;</span><br><span class="line">                <span class="keyword">var</span> group = j.groupCode;</span><br><span class="line">                <span class="keyword">if</span>(group.findIndex(<span class="function"><span class="params">item</span> =&gt;</span> item === i.keyCode) != -<span class="number">1</span>) &#123;</span><br><span class="line">                    group.splice(group.findIndex(<span class="function"><span class="params">item</span> =&gt;</span> item === i.keyCode), <span class="number">1</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(flag == <span class="number">0</span>) &#123;</span><br><span class="line">        tempKey.keyDown();</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">var</span> i <span class="keyword">in</span> tempKeyGroup) &#123;</span><br><span class="line">            <span class="keyword">if</span>(tempKeyGroup[i].groupCode.toString() == [val].toString()) &#123;</span><br><span class="line">                <span class="comment">// console.log(tempKey.keyGroup[i].callback)</span></span><br><span class="line">                tempKey.keyGroup[i].callback();</span><br><span class="line">                <span class="comment">// 多按键组合只用一个，</span></span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="关于事件绑定"><a href="#关于事件绑定" class="headerlink" title="关于事件绑定"></a>关于事件绑定</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">keyDown</span>(<span class="params">keyCode, callback_1, callback_2=<span class="keyword">function</span>()&#123;&#125;</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">typeof</span> keyCode == <span class="string">&#x27;number&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span>(keys[i] == <span class="literal">undefined</span>) &#123;</span><br><span class="line">            <span class="keyword">var</span> key = <span class="keyword">new</span> Key(keyCode);</span><br><span class="line">            key.callback_1 = callback_1;</span><br><span class="line">            key.callback_2 = callback_2;</span><br><span class="line">            keys[keyCode] = key;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            keys[i].callback_1 = callback_1;</span><br><span class="line">            keys[i].callback_2 = callback_2;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">var</span> i <span class="keyword">of</span> keyCode) </span><br><span class="line">            <span class="keyword">if</span>(keys[i] == <span class="literal">undefined</span>) </span><br><span class="line">                keys[i] = <span class="keyword">new</span> Key(i);</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">var</span> i <span class="keyword">of</span> keyCode) &#123;</span><br><span class="line">            keys[i].keyGroup.push(&#123;<span class="attr">groupCode</span>: keyCode, <span class="attr">callback</span>: callback_1&#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">keyUp</span>(<span class="params">keyCode, callback</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(keys[i] == <span class="literal">undefined</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> key = <span class="keyword">new</span> Key(keyCode);</span><br><span class="line">        key.callback_2 = callback;</span><br><span class="line">        keys[keyCode] = key;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        keys[i].callback_2 = callback_2;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/07/21/200721-JsMultiKeyListener/" data-id="ckrdcmy5i0000mcuresw57kid" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-hello-hexo" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2021/07/11/hello-hexo/" class="article-date">
  <time datetime="2021-07-11T07:00:19.000Z" itemprop="datePublished">2021-07-11</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/07/11/hello-hexo/">Hello-Hexo</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="hello-hexo"><a href="#hello-hexo" class="headerlink" title="hello hexo"></a>hello hexo</h1><p>Hello, here is this static blog’s first post.<br>tesing…</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/07/11/hello-hexo/" data-id="ckqyvt8st0000a4urahsy4r1g" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-hello-world" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2021/07/11/hello-world/" class="article-date">
  <time datetime="2021-07-11T04:22:23.279Z" itemprop="datePublished">2021-07-11</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/07/11/hello-world/">Hello World</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Welcome to <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a target="_blank" rel="noopener" href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a target="_blank" rel="noopener" href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a target="_blank" rel="noopener" href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/writing.html">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/server.html">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/generating.html">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/07/11/hello-world/" data-id="ckqyp4k5l0000zkur7rw97a6r" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  


</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">归档_t</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/07/">七月 2021</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最新文章_t</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2021/07/21/200721-JsMultiKeyListener/">基于JavaScript的多按键检测</a>
          </li>
        
          <li>
            <a href="/2021/07/11/hello-hexo/">Hello-Hexo</a>
          </li>
        
          <li>
            <a href="/2021/07/11/hello-world/">Hello World</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2021 John Doe<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">主页 HomePage</a>
  
    <a href="/archives" class="mobile-nav-link">归档 Archives</a>
  
    <a href="/test" class="mobile-nav-link">nothing-1</a>
  
    <a href="/test" class="mobile-nav-link">nothing-2</a>
  
</nav>
    

<script src="//apps.bdimg.com/libs/jquery/1.9.1/jquery.min.js"></script>


  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">

  
<script src="/fancybox/jquery.fancybox.pack.js"></script>




<script src="/js/script.js"></script>




  </div>
</body>
</html>